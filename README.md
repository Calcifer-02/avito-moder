# Система модерации объявлений Авито

Веб-приложение для модерации объявлений на платформе Авито.

## Технологический стек

### Frontend
- **React 19.2** - UI библиотека
- **TypeScript 5.9** - статическая типизация
- **Vite 7.2** - сборщик и dev-сервер
- **React Router DOM 6** - клиентская маршрутизация
- **TanStack React Query v5** - управление серверным состоянием и кешированием
- **Axios** - HTTP клиент
- **Redux Toolkit** - управление глобальным состоянием (настройки, тема)
- **Framer Motion** - анимации и переходы
- **React Icons** - иконки
- **jsPDF & jsPDF-AutoTable** - генерация PDF отчетов
- **Vitest** - фреймворк для тестирования
- **Testing Library** - утилиты для тестирования React компонентов

### Backend
- **Node.js v20** - серверная платформа
- **Express.js 4** - веб-фреймворк

## Функциональность

### Реализованные страницы

#### 1. `/list` - Список объявлений
-  Отображение объявлений в виде карточек
-  Фильтрация по статусу (множественный выбор)
-  Фильтрация по категории
-  Фильтрация по диапазону цен
-  Поиск по названию
-  Сортировка (по дате, цене, приоритету)
-  Пагинация (10 элементов на страницу)
-  URL-синхронизация фильтров
-  Сброс всех фильтров

#### 2. `/item/:id` - Детальная страница объявления
-  Галерея изображений (3+ фото)
-  Полное описание товара
-  Характеристики в виде таблицы
-  Информация о продавце
-  История модерации
-  Панель действий модератора (одобрить/отклонить/вернуть на доработку)
-  Модальное окно с выбором причины отклонения
-  Горячие клавиши (A, D, ←, →)
-  Навигация между объявлениями

#### 3. `/stats` - Статистика модератора
- Карточки с метриками (всего проверено, проценты, среднее время)
- График активности по дням (столбчатая диаграмма)
- Круговая диаграмма распределения решений
-  График по категориям проверенных объявлений
-  Фильтр по периоду (сегодня/неделя/месяц/произвольный)
-  Экспорт статистики в CSV *(со звёздочкой)*
-  Генерация PDF-отчёта *(со звёздочкой)*

### Дополнительные функции (со звёздочкой)

1. **Горячие клавиши**
   - `A` - одобрить объявление
   - `D` - отклонить объявление
   - `→` - следующее объявление
   - `←` - предыдущее объявление
   - `/` - фокус на поиск

2. **Bulk-операции**
   - Чекбоксы для выбора нескольких объявлений
   - Массовое одобрение
   - Массовое отклонение
   - Счётчик выбранных объявлений
   - Выбор всех/снять выбор

3. **Продвинутая фильтрация** 
   - URL-синхронизация фильтров (можно поделиться ссылкой)
   - Сохранение состояния фильтров при переходах

4. **Тёмная тема** 
   - Переключатель темы в header
   - Сохранение выбора в Redux store
   - Плавные переходы между темами

5. **Экспорт данных** 
   - Экспорт статистики в CSV
   - Генерация PDF-отчёта
   - Экспорт в соответствии с выбранным периодом

6. **Анимации** 
   - Плавные переходы между страницами (framer-motion)
   - Анимация появления карточек
   - Hover-эффекты
   - Progress индикаторы при загрузке

7. **Прерывание запросов** 
   - Автоматическая отмена запросов при переходе со страницы (React Query)
   - Оптимизация производительности

8. **Данные модератора** 
   - Отображение реальных данных модератора с бэкенда в header
   - Имя и роль модератора

## Установка и запуск

### Требования
- Node.js v20+
- npm или yarn

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd avito-int3
```

### 2. Установка зависимостей

#### Backend
```bash
cd tech-int3-server
npm install
```

#### Frontend
```bash
cd ../client
npm install
```

### 3. Запуск проекта

#### Запуск backend (в одном терминале)
```bash
cd tech-int3-server
npm start
```
Backend будет доступен на `http://localhost:3001`

#### Запуск frontend (в другом терминале)
```bash
cd client
npm run dev
```
Frontend будет доступен на `http://localhost:3000`

### 4. Открытие приложения
Откройте браузер и перейдите на `http://localhost:3000`

## Структура проекта

```
avito-int3/
├── tech-int3-server/          # Backend API
│   ├── src/
│   │   ├── controllers/       # Контроллеры API
│   │   ├── models/            # Модели данных
│   │   └── routes/            # Маршруты API
│   ├── server.js              # Точка входа сервера
│   └── package.json
│
└── client/                    # Frontend приложение
    ├── src/
    │   ├── components/        # React компоненты
    │   │   ├── AdDetail/      # Компоненты детальной страницы
    │   │   │   ├── AdInfo/    # Информация об объявлении
    │   │   │   ├── ImageGallery/        # Галерея изображений
    │   │   │   ├── ModerationHistory/   # История модерации
    │   │   │   ├── ModerationModal/     # Модальное окно модерации
    │   │   │   ├── ModerationPanel/     # Панель действий модератора
    │   │   │   └── SellerCard/          # Карточка продавца
    │   │   ├── AdsList/       # Компоненты списка объявлений
    │   │   │   ├── AdCard/    # Карточка объявления
    │   │   │   ├── BulkActionsPanel/    # Панель массовых действий
    │   │   │   ├── BulkRejectModal/     # Модальное окно массового отклонения
    │   │   │   ├── FiltersPanel/        # Панель фильтров
    │   │   │   ├── HeroSection/         # Заголовок страницы
    │   │   │   └── Pagination/          # Пагинация
    │   │   ├── AnimatedPage/  # HOC для анимации страниц
    │   │   ├── layout/        # Layout компоненты (Header, Layout)
    │   │   └── Stats/         # Компоненты статистики
    │   │       ├── ActivityChart/       # График активности
    │   │       ├── CategoriesChart/     # График категорий
    │   │       ├── DecisionsChart/      # Круговая диаграмма
    │   │       ├── MetricCard/          # Карточка метрики
    │   │       └── PeriodFilter/        # Фильтр периода
    │   ├── pages/             # Страницы приложения
    │   │   ├── AdDetail/      # Страница детального просмотра
    │   │   ├── AdsList/       # Страница списка объявлений
    │   │   └── Stats/         # Страница статистики
    │   ├── services/          # API сервисы
    │   │   └── api/           # HTTP клиенты и сервисы
    │   │       ├── adsService.ts         # Сервис объявлений
    │   │       ├── statsService.ts       # Сервис статистики
    │   │       ├── moderatorsService.ts  # Сервис модераторов
    │   │       └── client.ts             # Axios клиент
    │   ├── store/             # Redux store
    │   │   ├── slices/        # Redux slices
    │   │   │   └── settingsSlice.ts     # Настройки (тема)
    │   │   ├── hooks.ts       # Typed Redux hooks
    │   │   └── index.ts       # Конфигурация store
    │   ├── hooks/             # React хуки
    │   │   ├── useAds.ts      # Хук для работы с объявлениями
    │   │   ├── useStats.ts    # Хук для статистики
    │   │   ├── useModerators.ts  # Хук для модераторов
    │   │   └── useTheme.ts    # Хук для темы
    │   ├── types/             # TypeScript типы
    │   │   └── index.ts       # Все типы приложения
    │   ├── utils/             # Утилиты
    │   │   ├── constants.ts   # Константы
    │   │   ├── export.ts      # Экспорт в CSV/PDF
    │   │   ├── format.ts      # Форматирование данных
    │   │   └── status.ts      # Утилиты для статусов
    │   ├── assets/            # Статические ресурсы
    │   │   ├── fonts/         # Шрифты (PT Sans для PDF)
    │   │   └── Layer.svg      # Логотип
    │   ├── __tests__/         # Тесты (360 тестов)
    │   │   ├── components/    # Тесты компонентов
    │   │   ├── store/         # Тесты Redux store
    │   │   ├── utils/         # Тесты утилит
    │   │   └── mocks/         # Mock данные
    │   ├── App.tsx            # Главный компонент
    │   └── main.tsx           # Точка входа
    ├── scripts/               # Скрипты
    │   └── convertFont.js     # Конвертация шрифтов в base64
    ├── vite.config.ts         # Конфигурация Vite + Vitest
    ├── tsconfig.json          # Конфигурация TypeScript
    ├── vitest.config.ts       # Конфигурация тестов
    └── package.json
```

## Особенности реализации

### Архитектурные решения

1. **Управление состоянием**
   - React Query для серверного состояния
   - URL параметры для фильтров и пагинации
   - Local state для UI состояния

2. **Типизация**
   - Строгая типизация TypeScript
   - Типы на основе OpenAPI схемы сервера
   - Type-safe API calls

3. **API Layer**
   - Трёхуровневая архитектура (API Client → Service → Hooks)
   - Автоматическое кеширование через React Query
   - Оптимистичные обновления

4. **Производительность**
   - Кеширование запросов (stale-while-revalidate)
   - URL-синхронизация без лишних рендеров
   - Debounce для поиска (можно добавить)

### Горячие клавиши
- `A` - Одобрить объявление
- `D` - Отклонить объявление
- `←` - Предыдущее объявление
- `→` - Следующее объявление
- `/` - Фокус на поиск (можно добавить)

## API Документация

API документация доступна в файле `client/API_DOCUMENTATION.md`

### Основные endpoints

- `GET /api/v1/ads` - Список объявлений
- `GET /api/v1/ads/:id` - Детали объявления
- `POST /api/v1/ads/:id/approve` - Одобрить
- `POST /api/v1/ads/:id/reject` - Отклонить
- `POST /api/v1/ads/:id/request-changes` - Вернуть на доработку
- `GET /api/v1/stats/summary` - Статистика
- `GET /api/v1/stats/chart/activity` - График активности
- `GET /api/v1/stats/chart/decisions` - График решений
- `GET /api/v1/stats/chart/categories` - График категорий

## Скрипты

### Backend
```bash
npm start      # Запуск сервера
npm run dev    # Запуск в режиме разработки (nodemon)
```

### Frontend
```bash
npm run dev      # Запуск dev-сервера
npm run build    # Сборка для production
npm run preview  # Просмотр production сборки
npm run lint     # Проверка кода
npm run test     # Запуск тестов в watch mode
npm run test:run # Запуск тестов один раз
npm run test:ui  # Запуск тестов с UI интерфейсом
```

## Тестирование

Проект покрыт юнит-тестами с использованием **Vitest** и **React Testing Library**.

### Статистика покрытия
- **360 тестов** покрывают все компоненты, сервисы и утилиты
- **100% покрытие** критичной функциональности
- Тесты для компонентов, Redux store, API сервисов и утилит

### Запуск тестов

```bash
cd client

# Запуск всех тестов один раз
npm run test:run

# Запуск тестов в watch mode (автоматический перезапуск при изменениях)
npm run test

# Запуск тестов с UI интерфейсом
npm run test:ui
```

### Структура тестов

```
client/src/__tests__/
├── components/           # Тесты React компонентов
│   ├── AdDetail/        # Тесты компонентов детальной страницы (88 тестов)
│   ├── AdsList/         # Тесты компонентов списка (121 тест)
│   ├── Stats/           # Тесты компонентов статистики (107 тестов)
│   └── AnimatedPage.test.tsx
├── store/               # Тесты Redux store (10 тестов)
│   └── settingsSlice.test.ts
├── utils/               # Тесты утилит (23 теста)
│   ├── format.test.ts
│   └── status.test.ts
└── mocks/               # Mock данные для тестов
    └── data.ts
```

```
client/src/services/api/  # Тесты API сервисов (56 тестов)
├── adsService.test.ts         # 28 тестов
├── statsService.test.ts       # 19 тестов
├── client.test.ts             # 6 тестов
└── moderatorsService.test.ts  # 3 теста
```

### Что покрыто тестами

**Компоненты (310 тестов):**
- ✅ Все компоненты AdDetail (галерея, карточка продавца, история модерации, модальные окна)
- ✅ Все компоненты AdsList (карточки, фильтры, пагинация, массовые действия)
- ✅ Все компоненты Stats (графики, метрики, фильтры периода)
- ✅ Layout компоненты (Header, Layout)
- ✅ HOC компоненты (AnimatedPage)

**API Сервисы (56 тестов):**
- ✅ adsService - CRUD операции, массовые действия, фильтрация
- ✅ statsService - получение статистики и графиков
- ✅ client - конфигурация axios, interceptors
- ✅ moderatorsService - получение данных модератора

**Redux Store (10 тестов):**
- ✅ settingsSlice - управление темой и настройками

**Утилиты (23 теста):**
- ✅ format.ts - форматирование дат, цен, времени
- ✅ status.ts - утилиты для работы со статусами

### Примеры запуска

```bash
# Запуск только тестов компонентов
npm run test -- components

# Запуск только тестов сервисов
npm run test -- services

# Запуск конкретного файла
npm run test -- AdCard.test.tsx

# Запуск с отчетом о покрытии
npm run test:run -- --coverage
```

## UI/UX особенности

- Адаптивный дизайн
- Интуитивная навигация
- Визуальная индикация статусов
- Плавные переходы и анимации
- Удобные фильтры с множественным выбором
- Быстрая модерация с горячими клавишами


## TODO / Дополнительные возможности

- [x] Bulk-операции (массовое одобрение/отклонение)
- [x] Тёмная тема
- [x] Экспорт статистики (CSV, PDF)
- [x] Юнит-тесты (Vitest)
- [ ] Real-time обновления через WebSocket
- [ ] E2E тесты (Playwright)
- [ ] Docker контейнеризация

## Контакты

При возникновении вопросов обращайтесь к @Calcifer_02 в Telegram.

## Лицензия

MIT

